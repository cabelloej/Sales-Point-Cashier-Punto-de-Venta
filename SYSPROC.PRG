****************
PROCEDURE OPELIN
****************
SELECT 1
USE SYSLIN INDEX SYSLIN
RETURN

****************
PROCEDURE INDLIN
****************
DEFI WIND WININD FROM 05,00 TO 07,42 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
@ 00,00 SAY "Lineas, Favor esperar..."
***
USE SYSLIN
IF FILLOC()
   INDEX ON CODIGO    TO SYSLIN
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
RELE WIND WININD
RETURN

****************
PROCEDURE OPEART
****************
SELECT 2
USE SYSART INDEX SYSART1,SYSART2,SYSART3
RETURN
****************
PROCEDURE INDART
****************
DEFI WIND WININD FROM 05,00 TO 07,42 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
@ 00,00 SAY "Articulos, Favor esperar..."
***
USE SYSART
IF FILLOC()
   INDEX ON CODIGO                                TO SYSART1
   INDEX ON LINEA+CODIGO                          TO SYSART2
   INDEX ON DESCRI                                TO SYSART3
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
RELE WIND WININD
RETURN
***

*****************
PROCEDURE OPEVTAG
*****************
SELECT 3
USE SYSVTAG INDEX SYSVTAG1,SYSVTAG2,SYSVTAG3
RETURN
*****************
PROCEDURE INDVTAG
*****************
DEFI WIND WININD FROM 05,00 TO 07,42 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
@ 00,00 SAY "Ventas general, Favor esperar..."
***
USE SYSVTAG
IF FILLOC()
   INDEX ON FACTURA                 TO SYSVTAG1
   INDEX ON CLIENTE                 TO SYSVTAG2
   INDEX ON STR(YEAR(FECHA),4)+;
            STR(MONTH(FECHA),2)+;
            STR(DAY(FECHA),2)       TO SYSVTAG3
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
RELE WIND WININD
RETURN

*****************
PROCEDURE OPEVTAD
*****************
SELECT 4
USE SYSVTAD INDEX SYSVTAD1,SYSVTAD2,SYSVTAD3
RETURN
*****************
PROCEDURE INDVTAD
*****************
DEFI WIND WININD FROM 05,00 TO 07,42 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
@ 00,00 SAY "Ventas detallada, Favor esperar..."
***
USE SYSVTAD
IF FILLOC()
   INDEX ON FACTURA+RENGLON            TO SYSVTAD1
   INDEX ON STR(YEAR(FECHA),4)+;
            STR(MONTH(FECHA),2)+;
            STR(DAY(FECHA),2)+;
            FACTURA                    TO SYSVTAD2
   INDEX ON CODIGO+;
            STR(YEAR(FECHA),4)+;
            STR(MONTH(FECHA),2)+;
            STR(DAY(FECHA),2)          TO SYSVTAD3

ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
RELE WIND WININD
RETURN
****************
PROCEDURE OPEUSE
****************
****************
PROCEDURE INDUSE
****************
DEFI WIND WININD FROM 05,00 TO 07,42 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
@ 00,00 SAY "Usuarios, Favor esperar..."
***
USE SYSUSER
IF FILLOC()
   INDEX ON USERCODE  TO SYSUSER
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
USE SYSUSERD
IF FILLOC()
   INDEX ON USERCODE+PROGRAMA  TO SYSUSERD
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
USE SYSPRG
IF FILLOC()
   INDEX ON PROGRAMA      TO SYSPRG
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
RELE WIND WININD
RETURN


***
PROCEDURE RECLOC
DEFI WIND WINRLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGRL
STORE .F. TO WRECMES
STORE .T. TO WRECLOC
DO WHILE WRECLOC
   IF RLOCK()
      STORE .T. TO WFLAGRL
      EXIT
   ELSE
      IF .NOT. WRECMES
         ACTI WIND WINRLOCK
         @ 14,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WRECMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINRLOCK
RETURN WFLAGRL
******************************************************************************
FUNC FILLOC
DEFI WIND WINFLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGFL
STORE .F. TO WFILMES
STORE .T. TO WFILLOC
DO WHILE WFILLOC
   IF FLOCK()
      STORE .T. TO WFLAGFL
      EXIT
   ELSE
      IF .NOT. WFILMES
         ACTI WIND WINFLOCK
         @ 14,15 SAY "ARCHIVO  OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WFILMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINFLOCK
RETURN WFLAGFL
*************************
PROCEDURE MENSAJE
PARAMETERS WTEXT
DEFI WIND WINMES FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINMES
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
RELEASE WIND WINMES
RETURN
*************************
PROCEDURE AVISO
PARAMETERS WTEXT
DEFI WIND WINAVI FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINAVI
?? CHR(7)
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
READ
RELEASE WIND WINAVI
RETURN
*************************
PROCEDURE CHKPRINT
PARAMETERS SALTAR
store .t. to wprinting
do while wprinting
   store "Prepare la impresora y oprima <ENTTER> para continuar o (R)echazar" to Qmes
   @ 23,1
   @ 23,40-(len(Qmes)/2) say Qmes
   store " " to wstat
   @ 23,78 get wstat
   read
   if upper(wstat) = "R"
      store 1 to saltar
      store .f. to wprinting
   else
      store 0 to saltar
      if sys(13) = "READY"
         store .f. to wprinting
      endif
   endif
   @ 23,1
enddo
RETURN
****************
PROCEDURE CHKACC
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
   STORE FILTRO TO WFILTRO
ELSE
   STORE SPACE(1) TO WACCESO
   STORE SPACE(1) TO WFILTRO
ENDIF
RETURN
*****************
PROCEDURE ARMAFAC
*****************
STORE LTRIM(STR(WFACTURA,7))                    TO WFACTURAC
STORE REPLICATE("0",7-LEN(WFACTURAC))+WFACTURAC TO WFACTURAC
RETURN
*****************
PROCEDURE ARMAREN
*****************
STORE LTRIM(STR(WRENGLON,7))                    TO WRENGLONC
STORE REPLICATE("0",7-LEN(WRENGLONC))+WRENGLONC TO WRENGLONC
RETURN
