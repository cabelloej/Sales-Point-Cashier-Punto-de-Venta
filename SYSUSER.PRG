SELECT SYSUSER
SET RELA TO USERCODE INTO SYSUSERD
SELECT SYSUSERD
SET RELA TO PROGRAMA INTO SYSPRG
*** INI CONTROL DE ACCESO
STORE "SYSMENU " TO WPROGRAMA
STORE SPACE(1)  TO WACCESO
STORE SPACE(1)  TO WFILTRO
DO CHKACC WITH WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT sysuser
DEFI WIND BRuserg FROM LIBRusr,CIBRusr TO LIBRusr+10,CIBRusr+33 ;
                  TITLE " OPERADORES " ;
                  FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,ESC=Sel ";
                  DOUBLE NOZOOM NOGROW COLOR SCHEME 10
DEFI WIND BRuserd FROM LIBRusr,CIBRusr+34 TO LIBRusr+16,CIBRusr+79;
                  TITLE " DETALLE DE ACCESOS " ;
                  FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,ESC=Sel ";
                  DOUBLE NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND BRuserg
ON KEY LABEL F1 DO BRINC
ON KEY LABEL F2 DO BRMOD
ON KEY LABEL F3 DO BRELI
ON KEY LABEL F4 DO BRBUS
BROWSE FIELDS USERCODE:H="CODIGO", USERDESC:H="DESCRIPCION";
              NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE NOCLEAR;
              REST SAVE IN WINDOW BRUSERG WHEN USRACC()
ON KEY LABEL F1
ON KEY LABEL F2
ON KEY LABEL F3
ON KEY LABEL F4
ON KEY LABEL F5
RELEASE WIND BRUSERG
RELEASE WIND BRUSERD
RETURN
*************************
*** RUTINAS DE BRUSERG***
*************************
PROCEDURE BRINC
IF WACCESO<>"A"
   RETURN
ENDIF
*** FIN CONTROL DE ACCESO
DEFI WIND WINCPG FROM LIBRUSR+3,CIBRUSR TO LIBRUSR+10,CIBRUSR+33;
                 TITLE " INCLUIR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
DO WHILE .T.
   ACTI WIND WINCPG
   SCAT MEMV BLANK
   @ 00,00 CLEAR
   @ 00,01 SAY "CODIGO:"
   @ 00,09 GET M.USERCODE
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE M.USERCODE TO WCLAVEUSR
   IF LEN(TRIM(WCLAVEUSR))=0
      LOOP
   ENDIF
   SEEK WCLAVEUSR
   IF FOUND()
      @ 01,01 SAY "DESCRI:"
      @ 01,09 SAY USERDESC
      STORE "YA EXISTE, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      LOOP
   ELSE
      @ 01,01 SAY "DESCRI:"
      @ 01,09 GET M.USERDESC
      @ 02,01 SAY "CLAVE :"
      @ 02,09 GET M.USERACC
      @ 03,01 SAY "NOMBRE:"
      @ 03,09 GET M.USERNOM
      @ 04,01 SAY "PUNTO :"
      @ 04,09 GET M.USERUBI
      READ
      *** INICIO RUTINA DE ACEPTAR-CANCELAR
      store 1 to wop
      do while .t.
         @ 05,9  get wop pict "@*H Aceptar;Cancelar" defa wop
         read
         if lastkey()=13
            exit
         endif
      enddo
      *** FIN  RUTINA ACEPTAR-CANCELAR
      if wop=1
         if filloc()
            append blank
            gath memvar
            unlock all
         endif
         do SYSUSERB
         select SYSUSER
      endif
   ENDIF
ENDDO
RELEASE WIND WINCPG
RETURN
**********************
PROCEDURE BRMOD
IF EOF()
   RETURN
ENDIF
IF WACCESO<>"A".AND.WUSERCODE<>USERCODE
   RETURN
ENDIF
DEFI WIND WMODPG FROM LIBRUSR+3,CIBRUSR TO LIBRUSR+10,CIBRUSR+33;
                 TITLE " MODIFICAR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WMODPG
SCAT MEMVAR
IF WACCESO="A"
   @ 00,01 SAY "CODIGO:"
   @ 00,09 SAY M.USERCODE
   @ 01,01 SAY "DESCRI:"
   @ 01,09 GET M.USERDESC
   @ 02,01 SAY "CLAVE :"
   @ 02,09 GET M.USERACC
   @ 03,01 SAY "NOMBRE:"
   @ 03,09 GET M.USERNOM
   @ 04,01 SAY "PUNTO :"
   @ 04,09 GET M.USERUBI
ELSE
   @ 00,01 SAY "CODIGO:"
   @ 00,09 SAY M.USERCODE
   @ 01,01 SAY "DESCRI:"
   @ 01,09 SAY M.USERDESC
   @ 02,01 SAY "CLAVE :"
   @ 02,09 GET M.USERACC
   @ 03,01 SAY "NOMBRE:"
   @ 03,09 SAY M.USERNOM
   @ 04,01 SAY "DEPTO.:"
   @ 04,09 SAY M.USERUBI
ENDIF
READ
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 05,09  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      gath memvar
      unlock all
   endif
   IF WACCESO="A"
      do SYSUSERB
   ENDIF
   select SYSUSER
endif
RELEASE WIND WMODPG
RETURN
**********************
PROCEDURE BRELI
IF WACCESO<>"A"
   RETURN
ENDIF
DEFI WIND WELISER FROM LIBRUSR+3,CIBRUSR TO LIBRUSR+06,CIBRUSR+33;
                  TITLE " ELIMINAR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WELISER
SCAT MEMVAR
@ 00,01 SAY M.USERCODE
@ 00,06 SAY M.USERDESC
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 01,09  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      delete
      select SYSUSERD
      if filloc()
         delete all for USERCODE = SYSUSER.USERCODE
         unlock all
         select SYSUSER
      endif
      unlock all
   endif
endif
RELEASE WIND WELISER
RETURN
**********************
PROCEDURE BRBUS
DEFI WIND WBUSSER FROM LIBRUSR+3,CIBRUSR TO LIBRUSR+06,CIBRUSR+33;
                  TITLE " BUSCAR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WBUSSER
DO WHILE .T.
   SCAT MEMV BLANK
   @ 00,01 GET M.USERCODE
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE M.USERCODE TO WCLAVEUSR
   IF LEN(TRIM(WCLAVEUSR))=0
      LOOP
   ENDIF
   SEEK WCLAVEUSR
   IF FOUND()
      EXIT
   ELSE
      STORE "NO REGISTRADO, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
   ENDIF
ENDDO
RELEASE WIND WBUSSER
RETURN
**********************
FUNCTION USRACC
IF USERCODE<>WUSERCODE.AND.WACCESO<>"A"
   DEACT WIND BRUSERD
   RETURN
ELSE
ENDIF
SELECT SYSUSERD
ACTI WIND BRUSERD
BROWSE FIELDS SYSUSERD.PROGRAMA,SYSPRG.DESCRI:H="DESCRIPCION",ACCESO:H="TA",FILTRO:H="TD";
       NOAPPEND NODELETE NOEDIT NOCLEAR NOMENU NOWAIT NOOPTIMIZE REST IN WINDOW BRUSERD
ACTI WIND BRUSERG
RETURN

